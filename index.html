<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullscreen YouTube Video</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: black;
        }
        .container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        iframe {
            width: 100vw;
            height: 100vh;
            border: none;
        }
    </style>
    <script>
        let currentUrl = '';
    
        function extractUrlType(url) {
            const trimmedUrl = url.trim();
            const urlObj = new URL(trimmedUrl);
            const urlParams = new URLSearchParams(urlObj.search);
    
            if (urlParams.has('v')) {
                return { type: 'video', id: urlParams.get('v') };
            } else if (trimmedUrl.includes('live') || trimmedUrl.includes('/live/') || urlParams.has('channel')) {
                return { type: 'live', channel: urlParams.get('channel') || 'default' };
            }
            return { type: 'invalid' };
        }
    
        function buildEmbedUrl(info) {
            if (info.type === 'video') {
                return `https://www.youtube.com/embed/${info.id}?autoplay=1&mute=1&controls=0&showinfo=0&modestbranding=1&rel=0&loop=1&playlist=${info.id}&enablejsapi=1`;
            } else if (info.type === 'live') {
                return `https://www.youtube.com/embed/live_stream?channel=${info.channel}&autoplay=1&mute=1&controls=0&showinfo=0&modestbranding=1&rel=0&enablejsapi=1`;
            }
            return '';
        }
    
        async function checkForNewVideo() {
            try {
                const response = await fetch(`https://singhanat.github.io/youtube-fullscreen/url.txt?t=${Date.now()}`);
                const url = (await response.text()).trim();
    
                if (!url || url === currentUrl) return;
    
                const newInfo = extractUrlType(url);
                if (newInfo.type === 'invalid') {
                    console.error('Invalid YouTube URL in url.txt');
                    return;
                }
    
                currentUrl = url;
                location.reload(); // รีเฟรชหน้าเมื่อ URL เปลี่ยน
            } catch (error) {
                console.error('Error checking for video URL:', error);
            }
        }
    
        window.onload = function () {
            checkForNewVideo();
            setInterval(checkForNewVideo, 10000); // ตรวจทุก 10 วิ
    
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
            loadAndSetVideo(); // โหลด video เมื่อหน้าเพิ่งเปิด
        };
    
        async function loadAndSetVideo() {
            try {
                const response = await fetch(`https://singhanat.github.io/youtube-fullscreen/url.txt?t=${Date.now()}`);
                const url = (await response.text()).trim();
                currentUrl = url;
    
                const info = extractUrlType(url);
                const embedUrl = buildEmbedUrl(info);
    
                if (!embedUrl) {
                    console.error('Failed to build embed URL');
                    return;
                }
    
                document.getElementById('youtubePlayer').src = embedUrl;
            } catch (error) {
                console.error('Error loading initial video:', error);
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <iframe 
            id="youtubePlayer"
            src="" 
            allow="autoplay; fullscreen" 
            allowfullscreen>
        </iframe>
    </div>
</body>
</html>
